# 策划文档

此文档记录策划思路以及工作安排

## 2017年7月21日, Friday

接下来需要完成的任务:

1. 优化编辑器,尤其是地图编辑器和怪物数值编辑器,以便后续能够方便设置数值
2. 优化事件结构，把部分数据挪到拥有事件的对象或者地图位置上
3. 继续完成事件,主要是地图传送事件、道具事件和选择事件，另外还要为一次性事件添加自移除机制
4. 优化已完成的事件，主要是对话事件和战斗事件的屏幕适配
5. 优化 JsonParser , 采用就地截取制,或者干脆把Json处理成 binary, 用 binary 读取,总之要提高配置读取速度
6. 优化UI资源，使其更美观
7. 为战斗添加跳数字标志和 Miss 标志，更正美术资源
8. 简略设置一批数值，然后集中 debug 已完成的功能
9. 整理代码格式和框架结构，添加必要的注释
10. 打出 android 包和 iOS 包，通过功能测试和适配测试
11. 添加几个大型动画资源，例如开场动画，VS boss 动画等

## 2017年8月23日, Wednesday

+ 事件结构已优化, 基本通过测试
+ 地图编辑器的 bug 已修复, 现在可以正常编辑地图了
+ 获取基本资源型道具的事件已完成, 需要进一步测试（在2楼摆放更多物品进行测试）
+ 跨地图传送事件已通过测试，但是有一个 bug (见下)
+ 怪物数据编辑器需要进行便利性优化, 这是接下来要进行的工作
+ Bug: 重要级，跨地图第一次传送时，由于载入延迟，导致角色传送后多走了一步
+ Bug: 一般级，退出地图编辑器然后进入游戏时，报错，无法正常游戏
+ Bug: 轻微级，开门时，仍然可以继续触发开门事件（会继续扣钥匙并重复播放音效），应加入一个开门 loading 状态来解决此问题

## 2017年8月24日, Thursday

1. 完成 loading 幕布的动画
2. 解决开门事件重复触发的 bug
3. **完成 choice 事件的功能**
4. 对对话框, 战斗框和选择框进行适配和UI优化, 添加跳数字和跳 Miss 的效果
5. 对前几层进行正式的内容规划设计, 并反复测试功能和体验
6. 优化数据读取(如20170721中第5点所述)
7. 配置好 android 包, ios 包和 win-app-store 的包, 尝试打包
8. 整理代码结构, 添加必要注释

## 2017年9月14日, Thursday

1. 对对话框, 战斗框和选择框进行适配和UI优化, 添加跳数字和跳 Miss 的效果
2. **完成choice事件的功能**
3. 对前几层进行正式的内容规划设计, 并反复测试功能和体验
4. 整理代码结构, 添加必要注释
5. 优化数据读取(如20170721中第5点所述)
6. 配置好 android 包, ios 包和 win-app-store 的包, 尝试打包

## 2017年9月29日, Friday

1. 完成 CallEventAt 事件和 CannotMove 事件
2. 完成部分道具的实际效果数值及首次 Tips 提示
3. 继续对对话框, 战斗框和选择框进行适配和UI优化, 添加跳数字和跳 Miss 的效果
4. **完成 choice 事件的功能**，完成商店功能
5. 继续设计前几层的内容，补充剧情，调整设计和数值, 并反复测试功能和体验
6. 整理代码结构, 添加必要注释
7. 优化数据读取(如20170721中第5点所述)
8. 配置好 android 包, ios 包和 win-app-store 的包, 尝试打包

## 2018年3月16日, Friday
1. 关于 choice 事件功能,有如下工作需要继续完成:
 + ~~按钮响应功能~~ (2018.3.17)
 + ~~选项间距适配~~ (2018.4.19)
 + 整个 choice 框的高度适配, 以及语言文本框部分的高度适配, 可能需要与字体大小适配一起进行
 + speaker 头像修正,及位置适配
 + 选项指示, 快捷键
 + 选项文本内容的数值 replace
 + 更丰富的选取和选择特效, 例如颜色变化, 音效等
 + 字体大小的适配, 框位置的适配
2. 关于战斗框, 有如下工作需要完成:
 + 字体大小适配, 框位置的适配
 + 战斗失败功能
 + 框大小的适配, 长宽比不要太大
 + 中途撤退功能, 暂停功能, 插入对话功能
 + 战斗胜利和战斗失败音效
 + 战斗结果提示修正
 + 资源替换
 + 跳数字, 跳 miss 的资源,音效及功能
3. 关于对话框和 tips 框, 有如下工作需要完成:
 + ~~字体大小适配, 框位置的适配~~ (2018.4.25)(2018.6.13 完成了框位置的随屏幕缩放适配)
4. 关于传送功能, 有如下工作需要完成:
 + curtain 内容添加(楼层, 传送时选择功能, 将来还会添加传送时缩略地图, 还有就是 Esc 主菜单提示)
 + curtain 淡入淡出功能
 + 传送音效, 同层传送角色淡入淡出功能
 + 测试传送阵跨地图传送功能
5. 完成部分道具的实际效果数值及首次Tips提示
6. 设计前11层的内容, 补充对话和商店功能, 测试体验
7. 配置好 android 包, ios 包和 win-app-store 的包, 尝试打包
8. 整理代码结构, 添加必要注释, 把 MainScene 里过于臃肿的功能代码尝试分离出来, 各种对话框可以尝试分离成 prefab
9. 添加几个大型动画资源，例如开场动画，VS boss 动画等

## 2018年3月17日, Saturday
1. 修复了 choice 按钮响应的 bug, bug 产生原因是: 按钮被 curtain 挡住; 解决方法是: 让 curtain隐藏, 即 SetActive(false), 在需要显示时再出现
2. 下一项工作: 调整选项的位置和大小适配, 解决选项首次出现时, 选项个数不对的问题

## 2018年4月19日, Thursday
1. 修正了 choice 按钮的选项列表适配和大小间距适配, 采用了 VerticalLayoutGroup 控件, 不再使用代码进行适配, 但框的高度仍然用代码适配, 目前在较小高度的屏幕上仍有问题, 需要稍后解决

## 2018年4月24日, Tuesday
1. 已经重构了整个项目代码结构, 进行了更工整的分类, 并且将所有对话框从 MainScene 中分离了出来. 分离出来的对话框, 功能基本正常, ~~但是表现上仍有一些头像错误(应该是第一次写时生成头像的代码 copy 错误)的问题, 需要检查代码. 另外, 适配还没有优化~~(这些问题与2018年12月陆续全部解决)
2. 添加了对象池 ObjectPool. 现在, 所有的 Prefab, 都加入了对象池
3. 完成了对 Android 平台以及 WebGL 平台的打包测试, 可以正常运行. 但 WebGL 平台有无法显示中文的问题, 以及内存过大(与 json 读取方式过于低效有关)的问题, 512MB 内存仍不能满足, 必须要优化数据读取.
4. 已经优化了初始化方式. 现在, 每个 Scene 都可以独立初始化, 无需从 StartScene 进入

## 2018年6月29日, Friday
1. 自动寻路已完成, 仍有如下问题:
 + 终点为不可过物品时仍然不能正常寻路(路径大于2长度)
 + 需要将可过门设为0优先级(完全可过)路径, 同时将带有传送事件的地方设置为9优先级(不可过)路径, 否则传送事件会使自动寻路出问题
 + ~~安卓手机上关于事件触发和 Touch 判定有着各种各样奇怪的 bug, 需要专门针对性调试, 找出问题原因, 不确定 iOS 上是否有此类问题~~(2018年7月3日)
 
## 2018年7月3日, Tuesday
1. 安卓的大部分 bug 已修复:
 + 触摸事件同时也会触发 Mouse 左键事件, 因此在有触摸点的情况下对鼠标事件进行了屏蔽
 + 修复了一个无法触发对话后续事件的 bug (新写出的 bug)
2. 修复了对象池的 bug, 由于没有记录 id 导致存取时不一样, 对象池无法生效, 旧对象持续积累
3. 下一步继续修复 bug, 包括寻路仍然检测终点的 bug
4. 发现一个 bug: 寻路最优路径筛选有误, 没有选择绕路的高优先级路径
5. 发现一个 bug: 寻路结束后, 必须再点击一下才能(通过点击目的地)继续正常寻路
6. 出现过一个偶现 bug : 自动寻路开门时, 某种点击方法可使门无限循环播放开门

## 2018年7月20日, Friday
1. 完成了对国际化语言字符串的整理和调用, 现在继续整理和优化数据编辑器以便更好地设置数据

## 2018年12月5日, Wednesday
1. 修复了一个 bug, 曾导致从 StartScene 进入 DataEditorScene 然后退回到 StartScene 之后, 此时若再进入到 MainScene 或 DataEditorScene , 将会崩溃. bug 原因是: 退出 Scene 时没有对 ObjectPool 进行清空

## 2018年12月6日, Thursday
1. 修复了一个 bug, 曾导致 DataCenter 的数据被(DataEditorScene)改变之后, 没有同步到 MapManager, 也没有清空 MapManager, 致使改动无法实际生效 (仅仅是在编辑器选项栏中生效, 地图栏刷新以后也会复原)
2. 完成了对话/选择设计编辑器的UI摆放, 下一步完成功能, 同时优化编辑器其他部分
   
## 2018年12月7日, Friday
1. 制作了一个简单的 ListView, 使用方式大致类似于 cocos2d 里的 ListView, 用于UI中的各种列表, 尚未测试, 添加到编辑器里进行测试

## 2018年12月10日, Monday
1. 发现由于没有存档读取功能, 导致退出 MainScene 再重新进入时, 状态与退出前一样, 且在 DataEditorScene 修改楼层之后进入 MainScene 会有各种问题. 现在做了处理, 使得回到 StartScene 时重置地图数据, 但是人物数据还没有处理, 鉴于数据读取模块有可能重做, 先不处理
2. 完成了 ListView 的 debug 和应用
3. 为游戏中的 Sprite 建立了获取其 Image 的接口, 实际上直接通过 SpriteRenderer 获得 sprite 就行
4. 利用 ListView 完成了编辑器的 prefab 列表
5. 修复了编辑器 Modal 编辑的一个 bug, 这是由于 Id 比其 index 大1而之前未做处理(直接将 dropdown 获得的 index 当作id)
6. 接下来需要 ~~给编辑器中用到 prefab 或者 modal 的地方添加图片展示~~ (2018.12.11已完成) , ~~并修复下拉框不能自动滑动到所选项区域(导致每次都要滑很长)的问题~~ (2018.12.11决定无限期推迟, 因为稍微有点繁琐, 且并没有太大必要), 这些解决之后再去整理 DataEditorScene 的代码, 之后再去填充 String 类编辑器的功能

## 2018年12月12日, Wednesday
1. 完成了字符串编辑功能
2. 整理了 DataEditorScene 的结构, 将多 Canvas 改成 Panel, 计划把 MainScene 也按此修改, 以后不再出现多个 Canvas 的情况
3. 为 TipBar 添加延时自移除功能

## 2018年12月18日, Tuesday
1. 编辑器的 Chat/Choice 内容列表还未完成, 决定先把游戏内的功能解决一波
2. 尝试了一下将 DialogCanvas 合并进主 Canvas, 发现不太好使, 又还原了
   
## 2018年12月19日, Wednesday
1. 使用 ContentSizeFitter 和 VerticalLayoutGroup 的结合, 彻底解决了 Choice 对话框的大小自动适配问题, 删掉了代码的原相关功能部分
2. 精调了所有5个对话框的适配问题, 现在总体上没问题了, 剩下如下bug:
 + ~~Choice 对话框人物头像位置仍有问题, 原因不明~~(2018年12月20日解决), 但另需要注意, Choice 对话框并没有在进入 Mainscene 时进行预加载
 + ~~Battle 对话框的文字位置仍需要调整~~(2018年12月21日解决)
3. 给 ObjectPool 添加了设定 Sprite 的 SortingOrder 的功能, 以解决 Sprite 层级混乱的问题
4. 修复了一个 bug, 曾导致 Zzhit 被瞬间移除, 并因此导致攻击频率过高, 原因是加入 ObjectPool 后, Zzhit 在被 reuse 时没有重置计时器

## 2018年12月20日, Thursday
1. 解决 Choice 对话框的所有适配 bug.
2. 解决 Choice 的一个 bug, 曾导致选完选项后, 后续键盘选择仍然会触发 Choice 的选项事件(点击后, 选项被按照 Checkbox 的形式已被锁定), 致使对话事件触发时, 游戏状态被还原至非对话状态, 从而造成对话 bug (理论上战斗等情况也会触发此bug)
3. 由于现在游戏标准分辨率被设定为1136*640, 因此, 所有UI图标按照这个分辨率进行了重设 (之前在此分辨率下显得扁一些)

## 2018年12月21日, Friday
1. 整理了 Battle 对话框的位置及适配问题
2. 为主界面添加了叉和菜单按钮, 菜单栏先不必做
3. 仍有如下问题需要修复:
   + 寻路相关 bugs (见 2018年7月3日记录 及 2018年6月29日记录)
   + 解决数据读取问题, 思考新的读取方案和编辑保存方案

## 2018年12月



